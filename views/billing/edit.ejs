<% layout("/layouts/boilerplate") %>

<div class="container">
  <div class="mt-4 shadow-sm card">
    <div class="card-header bg-warning text-dark">
      <h3 class="mb-0"><i class="bi bi-pencil-square me-2"></i>Edit Bill</h3>
    </div>
    <div class="card-body">
      <form 
        method="POST" 
        action="/billing/<%= customer._id %>/bills/<%= billing._id %>?_method=PUT" 
        novalidate 
        class="needs-validation"
      >
        
        <!-- Customer Information Section -->
        <fieldset class="p-3 mb-4 border rounded bg-light">
          <legend class="w-auto px-2 fs-5">Customer Information</legend>
          <div class="row g-3">
            <div class="col-md-6">
              <label for="custNo" class="form-label">Customer Number</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-person-vcard"></i></span>
                <input 
                  class="form-control custNo" 
                  type="number" 
                  id="custNo" 
                  name="custNo" 
                  value="<%= customer.num %>" 
                  required 
                  readonly
                />
              </div>
            </div>
            <div class="col-md-6">
              <label for="custName" class="form-label">Customer Name</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-person"></i></span>
                <input 
                  type="text" 
                  class="form-control custName" 
                  id="custName" 
                  name="customer[name]" 
                  value="<%= customer.name %>" 
                  readonly
                />
              </div>
            </div>
          </div>
        </fieldset>

        <!-- Product Information Section -->
        <fieldset class="p-3 mb-4 border rounded">
          <legend class="w-auto px-2 fs-5">Product Information</legend>
          <div class="row g-3">
            <div class="col-md-6">
              <label for="proNo" class="form-label">Product Number</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-upc"></i></span>
                <input 
                  class="form-control proNo" 
                  type="number" 
                  id="proNo" 
                  name="billing[proNo]" 
                  value="<%= billing.proNo %>" 
                  required 
                  onblur="getProName()"
                />
                <div class="invalid-feedback">Please select a valid product</div>
              </div>
            </div>
            <div class="col-md-6">
              <label for="proName" class="form-label">Product Name</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-box-seam"></i></span>
                <input 
                  type="text" 
                  class="form-control proName" 
                  id="proName" 
                  name="billing[proName]" 
                  value="<%= billing.proName %>" 
                  readonly
                />
              </div>
            </div>
            <div class="col-md-4">
              <label for="proPrice" class="form-label">Unit Price</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-currency-dollar"></i></span>
                <input 
                  type="number" 
                  class="form-control proPrice" 
                  id="proPrice" 
                  name="billing[proPrice]" 
                  value="<%= billing.proPrice %>" 
                  step="0.01"
                />
              </div>
            </div>
            <div class="col-md-4">
              <label for="qty" class="form-label">Quantity</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-123"></i></span>
                <input 
                  type="number" 
                  class="form-control qty" 
                  id="qty" 
                  name="billing[qty]" 
                  value="<%= billing.qty %>" 
                  min="1" 
                  required
                />
                <div class="invalid-feedback">Please enter valid quantity</div>
              </div>
            </div>
            <div class="col-md-4">
              <label for="bdate" class="form-label">Purchase Date</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-calendar"></i></span>
                <input 
                  type="date" 
                  class="form-control date" 
                  id="bdate" 
                  name="billing[date]" 
                  value="<%= new Date(billing.date).toISOString().split('T')[0] %>" 
                  required
                />
              </div>
            </div>
          </div>
        </fieldset>

        <div class="gap-2 mt-4 d-grid d-md-flex justify-content-md-end">
          <a href="/billing" class="btn btn-outline-secondary me-md-2">
            <i class="bi bi-arrow-left me-2"></i>Cancel
          </a>
          <button type="submit" class="px-4 btn btn-warning text-dark">
            <i class="bi bi-check-circle me-2"></i>Update Bill
          </button>
        </div>
      </form>
    </div>
  </div>
</div>