<% layout("/layouts/boilerplate.ejs") %>
<div class="bill-container">
  <!-- Customer Information Section -->
  <div class="customer-section">
    <div class="customer-info">
      <span class="info-label">Customer No:</span>
      <span class="info-value"><%= customer.num %></span>
    </div>
    <div class="customer-info">
      <span class="info-label">Name:</span>
      <span class="info-value"><%= customer.name %></span>
    </div>
    <div class="customer-info">
      <span class="info-label">Mobile:</span>
      <span class="info-value"><%= customer.phNo %></span>
    </div>
  </div>

  <!-- Billing Items Table -->
  <div class="bill-items">
    <div class="items-table">
      <div class="items-header">
        <div class="item-row header-row">
          <div class="item-cell">Item</div>
          <div class="item-cell">Date</div>
          <div class="item-cell">Qty</div>
          <div class="item-cell">Price</div>
          <div class="item-cell">Amount</div>
          <div class="item-cell action-cell">Actions</div>
        </div>
      </div>

      <div class="items-body">
        <% let totalAmount = 0 %> <% if(customer.billing &&
        customer.billing.length > 0) { %> <% for(let i = 0; i <
        customer.billing.length; i++) { const billing = customer.billing[i];
        const amount = billing.proPrice * billing.qty; totalAmount += amount; %>
        <div class="item-row">
          <div class="item-cell"><%= billing.proName %></div>
          <div class="item-cell">
            <%= billing.date.toLocaleDateString('en-GB') %>
          </div>
          <div class="item-cell"><%= billing.qty %></div>
          <div class="item-cell"><%= billing.proPrice.toFixed(2) %></div>
          <div class="item-cell"><%= amount.toFixed(2) %></div>
          <div class="item-cell action-cell">
            <a
              href="/billing/<%= customer._id%>/bills/<%= billing._id %>/edit"
              class="action-btn edit-btn"
            >
              <i class="fas fa-edit"></i>
            </a>
            <form
              method="POST"
              action="/billing/<%= customer._id %>/bills/<%= billing._id %>?_method=DELETE"
              class="inline-form"
            >
              <button type="submit" class="action-btn delete-btn">
                <i class="fas fa-trash-alt"></i>
              </button>
            </form>
          </div>
        </div>
        <% } %> <% } else { %>
        <div class="item-row no-items">
          <div class="item-cell" colspan="6">No billing items found</div>
        </div>
        <% } %>
      </div>
    </div>

    <!-- Total Amount Row -->
    <div class="total-row">
      <div class="total-label">Total Amount:</div>
      <div class="total-value">â‚¹<%= totalAmount.toFixed(2) %></div>
    </div>
  </div>

  <form action="/billing/<%=customer._id%>/new" method="GET">
    <!-- Action Buttons -->
    <div class="action-buttons">
      <button class="btn add-btn">
        <i class="fas fa-plus"></i> Add New Bill
      </button>
    </div>
  </form>
</div>
